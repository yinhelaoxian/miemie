<!-- miniprogram/pages/index/index.wxml -->
<view class="container">
  <view class="title">咩咩错题</view>
  
  <!-- 拍照按钮 -->
  <button class="take-photo-btn" bindtap="takePhoto">拍照录入错题</button>
  
  <!-- 裁剪界面 -->
  <view class="cropper-container" wx:if="{{showCropper}}">
    <image-cropper 
      id="image-cropper" 
      limit_move="{{false}}" 
      disable_rotate="{{true}}" 
      scale_ratio="{{0.5}}" 
      init_width="{{cropperWidth}}" 
      init_height="{{cropperHeight}}" 
      min_width="{{50}}" 
      max_width="{{maxWidth}}" 
      max_height="{{maxHeight}}" 
      lock_width="{{false}}" 
      lock_ratio="{{false}}" 
      imgSrc="{{originalPath}}" 
      bind:load="cropperload" 
      bind:imageload="loadimage"
    ></image-cropper>
    <view class="crop-tip">拖动或缩放调整裁剪框（可达图片全宽）</view>
    <button class="confirm-btn" bindtap="confirmCrop">确认裁剪</button>
  </view>
  
  <!-- 预览区域 -->
  <view class="preview-container" wx:if="{{thumbnail}}">
    <view class="preview-title">错题图片预览（已裁剪压缩，{{fileSize}}KB）</view>
    <image 
      class="preview-img" 
      src="{{thumbnail}}" 
      mode="widthFix" 
      bindtap="previewImage"
    />
    <view class="temp-storage-tip">✅ 图片已保存至微信临时存储</view>
    <button class="upload-btn" bindtap="uploadToCloud">存储到云端服务器</button>
  </view>
  
  <!-- 隐藏canvas用于JPEG压缩 -->
  <canvas canvas-id="tempCanvas" style="display: none;"></canvas>
</view>