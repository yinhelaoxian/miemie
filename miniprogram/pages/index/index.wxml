<!-- miniprogram/pages/index/index.wxml -->
<view class="container">
  <button bindtap="takePhoto" class="btn-take">📸 拍照录入错题</button>

  <!-- 剪裁界面 -->
  <view wx:if="{{isCropperShow}}" class="cropper-wrapper">
    <image-cropper
      id="imageCropper"
      src="{{src}}"
      cut="{{cutArea}}"
      min_width="{{50}}"
      max_width="{{maxWidth}}"
      max_height="{{maxHeight}}"
      lock_width="{{false}}"
      lock_ratio="{{false}}"
      bind:ok="onCropOk"
      bind:cancel="onCropCancel"
    />
    <view class="cropper-actions">
      <button bindtap="onCancelClick" class="btn-cancel">取消</button>
      <!-- 移除无效的 onOkClick，依赖组件内部确定按钮 -->
    </view>
  </view>

  <!-- 其他操作 -->
  <view wx:if="{{!isCropperShow && src}}" class="action-buttons">
    <button bindtap="uploadImage" class="btn-upload" disabled="{{!croppedImagePath}}">
      📤 上传到云端
    </button>
    <button bindtap="reTake" class="btn-retake">🔁 重新拍照</button>
  </view>

  <!-- 加载提示 -->
  <view wx:if="{{loading}}" class="loading-mask">
    <view class="loading-toast">{{loadingText}}</view>
  </view>

  <!-- 预览区域 -->
  <view wx:if="{{thumbnail}}" class="preview-container">
    <image src="{{thumbnail}}" mode="widthFix" class="preview-img" bindtap="previewImage"/>
    <view class="preview-tip">✅ 已上传至云端</view>
  </view>
</view>